# –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–µ–∫—Ç—É git-env-vault

**–î–∞—Ç–∞ –∞–Ω–∞–ª—ñ–∑—É:** 2025-01-XX  
**–í–µ—Ä—Å—ñ—è –ø—Ä–æ–µ–∫—Ç—É:** (–¥–∏–≤. package.json)

## üìä –ó–∞–≥–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ç—É—Å —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –°–¢–ê–¢–£–° –ï–ü–Ü–ö–Ü–í                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ï–ø—ñ–∫             ‚îÇ –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å   ‚îÇ –°—Ç–∞—Ç—É—Å                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Epic A: Config   ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 90% ‚îÇ ‚úÖ –ú–∞–π–∂–µ –ø–æ–≤–Ω—ñ—Å—Ç—é             ‚îÇ
‚îÇ Epic B: Crypto   ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 95% ‚îÇ ‚úÖ –ü–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ       ‚îÇ
‚îÇ Epic C: .env     ‚îÇ ‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  0% ‚îÇ ‚ùå –ö–†–ò–¢–ò–ß–ù–û –í–Ü–î–°–£–¢–ù–Ü–ô         ‚îÇ
‚îÇ Epic D: CLI      ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 90% ‚îÇ ‚ö†Ô∏è –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ Epic C        ‚îÇ
‚îÇ Epic E: TUI      ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 85% ‚îÇ ‚ö†Ô∏è –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ Epic C        ‚îÇ
‚îÇ Epic F: Features ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 60% ‚îÇ ‚ö†Ô∏è –ß–∞—Å—Ç–∫–æ–≤–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –í –ó–ê–ì–ê–õ–û–ú        ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 70% ‚îÇ ‚ùå –ù–ï –ö–û–ú–ü–Ü–õ–Æ–Ñ–¢–¨–°–Ø             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üî¥ –ö–†–ò–¢–ò–ß–ù–ê –ü–†–û–ë–õ–ï–ú–ê

### –í—ñ–¥—Å—É—Ç–Ω—ñ–π –º–æ–¥—É–ª—å `src/core/env/`

**–ü—Ä–æ–±–ª–µ–º–∞:** –£ —Ñ–∞–π–ª—ñ [`src/core/index.ts`](src/core/index.ts:3) —î –µ–∫—Å–ø–æ—Ä—Ç:
```typescript
export * from './env/index.js'
```

–ê–ª–µ **–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è `src/core/env/` –Ω–µ —ñ—Å–Ω—É—î!**

**–ù–∞—Å–ª—ñ–¥–∫–∏:**
1. ‚ùå –ü—Ä–æ–µ–∫—Ç **–Ω–µ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è**
2. ‚ùå –í—Å—ñ –∫–æ–º–∞–Ω–¥–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `renderDotenv`, `parseDotenv`, `diffEnv` - –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å
3. ‚ùå TUI –Ω–µ –ø—Ä–∞—Ü—é—î

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–¥—ñ:**

| –§—É–Ω–∫—Ü—ñ—è | –§–∞–π–ª–∏-—Å–ø–æ–∂–∏–≤–∞—á—ñ |
|---------|-----------------|
| `renderDotenv` | [`pull.ts`](src/cli/commands/pull.ts:62), [`edit.ts`](src/cli/commands/edit.ts:57), [`edit-flow.ts`](src/tui/flows/edit-flow.ts:41) |
| `parseDotenv` | [`edit.ts`](src/cli/commands/edit.ts:79), [`edit-flow.ts`](src/tui/flows/edit-flow.ts:65) |
| `diffEnv` | [`set.ts`](src/cli/commands/set.ts:57), [`edit.ts`](src/cli/commands/edit.ts:82), [`edit-flow.ts`](src/tui/flows/edit-flow.ts:68) |
| `formatSafeDiff` | [`set.ts`](src/cli/commands/set.ts:59), [`edit.ts`](src/cli/commands/edit.ts:95), [`edit-flow.ts`](src/tui/flows/edit-flow.ts:77) |
| `formatUnsafeDiff` | [`edit.ts`](src/cli/commands/edit.ts:93), [`edit-flow.ts`](src/tui/flows/edit-flow.ts:85) |

---

## üìã –î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø–æ –µ–ø—ñ–∫–∞—Ö

### Epic A: –§–æ—Ä–º–∞—Ç —Å—Ö–æ–≤–∏—â–∞, –∫–æ–Ω—Ñ—ñ–≥–∏, policy
**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å: 90%**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º—ñ—Ç–∫–∞ |
|-----------|------|--------|----------|
| Config –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è | [`load-config.ts`](src/core/config/load-config.ts) | ‚úÖ | –ü–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ |
| Policy –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è | [`load-policy.ts`](src/core/config/load-policy.ts) | ‚úÖ | –ü–æ–≤–Ω—ñ—Å—Ç—é —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ |
| SOPS config –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä | [`sops-config-gen.ts`](src/core/sops/sops-config-gen.ts) | ‚úÖ | –ì–µ–Ω–µ—Ä—É—î .sops.yaml |
| –¢–∏–ø–∏ | [`types/index.ts`](src/core/types/index.ts) | ‚úÖ | EnvVaultConfig, EnvVaultPolicy |
| –í–∞–ª—ñ–¥–∞—Ü—ñ—è | –í–±—É–¥–æ–≤–∞–Ω–∞ | ‚úÖ | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ version, required –ø–æ–ª—ñ–≤ |

**–©–æ –≤—ñ–¥—Å—É—Ç–Ω—î:**
- –°—Ö–µ–º–∏ JSON –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó config/policy (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

---

### Epic B: –ö—Ä–∏–ø—Ç–æ-–∞–¥–∞–ø—Ç–µ—Ä —ñ verify
**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å: 95%**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º—ñ—Ç–∫–∞ |
|-----------|------|--------|----------|
| SOPS Adapter | [`sops-adapter.ts`](src/core/sops/sops-adapter.ts) | ‚úÖ | –ü–æ–≤–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è |
| CI Verify | [`ci-verify.ts`](src/cli/commands/ci-verify.ts) | ‚úÖ | –ü–µ—Ä–µ–≤—ñ—Ä—è—î policy, .sops.yaml, —Ñ–∞–π–ª–∏ |
| Policy Signature | [`signature.ts`](src/core/policy/signature.ts) | ‚úÖ | ed25519 –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è |
| Canonical JSON | [`canonical-json.ts`](src/core/policy/canonical-json.ts) | ‚úÖ | –î–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∞ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è |

**–ú–µ—Ç–æ–¥–∏ SopsAdapter:**
- ‚úÖ `isAvailable()` - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ SOPS
- ‚úÖ `getVersion()` - –≤–µ—Ä—Å—ñ—è SOPS
- ‚úÖ `decrypt()` - —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è YAML
- ‚úÖ `decryptToString()` - —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –≤ —Å—Ç—Ä–æ–∫—É
- ‚úÖ `encrypt()` - —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è in-place
- ‚úÖ `encryptData()` - —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- ‚úÖ `updateKeys()` - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è recipient-—ñ–≤
- ‚úÖ `rotate()` - —Ä–æ—Ç–∞—Ü—ñ—è data key
- ‚úÖ `isEncrypted()` - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è

---

### Epic C: –†–µ–Ω–¥–µ—Ä .env –∑ –∫–µ—Ä–æ–≤–∞–Ω–∏–º–∏ –±–ª–æ–∫–∞–º–∏
**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å: 0%** ‚ùå

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|-----------|------|--------|
| Dotenv –ø–∞—Ä—Å–µ—Ä | `src/core/env/parse-dotenv.ts` | ‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ–π |
| Dotenv —Ä–µ–Ω–¥–µ—Ä–µ—Ä | `src/core/env/render-dotenv.ts` | ‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ–π |
| Diff —É—Ç–∏–ª—ñ—Ç–∏ | `src/core/env/diff-env.ts` | ‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ–π |
| Managed blocks | - | ‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ–π |
| Index –µ–∫—Å–ø–æ—Ä—Ç | `src/core/env/index.ts` | ‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ–π |

**–ü–æ—Ç—Ä—ñ–±–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏:**
1. `parseDotenv(content: string)` - –ø–∞—Ä—Å–∏–Ω–≥ .env –∑ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —ñ –ø–æ—Ä—è–¥–∫—É
2. `renderDotenv(data: EnvObject, options?: { order?: string[] })` - —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —É .env —Ñ–æ—Ä–º–∞—Ç
3. `diffEnv(old: EnvObject, new: EnvObject)` - –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–≤–æ—Ö –Ω–∞–±–æ—Ä—ñ–≤ –∑–º—ñ–Ω–Ω–∏—Ö
4. `formatSafeDiff(diff: DiffResult)` - –±–µ–∑–ø–µ—á–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è diff (–±–µ–∑ –∑–Ω–∞—á–µ–Ω—å)
5. `formatUnsafeDiff(diff: DiffResult, old: EnvObject, new: EnvObject)` - –ø–æ–≤–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è diff

---

### Epic D: UX-–∫–æ–º–∞–Ω–¥–∏
**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å: 90%** (–Ω–µ –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ Epic C)

| –ö–æ–º–∞–Ω–¥–∞ | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º—ñ—Ç–∫–∞ |
|---------|------|--------|----------|
| `init` | [`init.ts`](src/cli/commands/init.ts) | ‚úÖ | –ü—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ |
| `doctor` | [`doctor.ts`](src/cli/commands/doctor.ts) | ‚úÖ | –ü—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ |
| `pull` | [`pull.ts`](src/cli/commands/pull.ts) | ‚ö†Ô∏è | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `renderDotenv` |
| `edit` | [`edit.ts`](src/cli/commands/edit.ts) | ‚ö†Ô∏è | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `parseDotenv`, `renderDotenv`, `diffEnv` |
| `set` | [`set.ts`](src/cli/commands/set.ts) | ‚ö†Ô∏è | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `diffEnv` |
| `grant` | [`grant.ts`](src/cli/commands/grant.ts) | ‚úÖ | –ü—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ |
| `revoke` | [`revoke.ts`](src/cli/commands/revoke.ts) | ‚úÖ | –ü—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ |
| `rotate` | [`rotate.ts`](src/cli/commands/rotate.ts) | ‚úÖ | –ü—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ |
| `updatekeys` | [`updatekeys.ts`](src/cli/commands/updatekeys.ts) | ‚úÖ | –ü—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ |
| `ci-verify` | [`ci-verify.ts`](src/cli/commands/ci-verify.ts) | ‚úÖ | –ü—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ |
| `tui` | [`tui.ts`](src/cli/commands/tui.ts) | ‚ö†Ô∏è | –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ flows |

---

### Epic E: TUI
**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å: 85%** (–Ω–µ –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ Epic C)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|-----------|------|--------|
| –ì–æ–ª–æ–≤–Ω–∏–π –º–æ–¥—É–ª—å | [`run.ts`](src/tui/run.ts) | ‚úÖ |
| Select Action | [`select-action.ts`](src/tui/flows/select-action.ts) | ‚úÖ |
| Select Env | [`select-env.ts`](src/tui/flows/select-env.ts) | ‚úÖ |
| Select Services | [`select-services.ts`](src/tui/flows/select-services.ts) | ‚úÖ |
| Pull Flow | [`pull-flow.ts`](src/tui/flows/pull-flow.ts) | ‚úÖ |
| Edit Flow | [`edit-flow.ts`](src/tui/flows/edit-flow.ts) | ‚ö†Ô∏è |
| Set Flow | [`set-flow.ts`](src/tui/flows/set-flow.ts) | ‚ö†Ô∏è |
| Grant Flow | [`grant-flow.ts`](src/tui/flows/grant-flow.ts) | ‚úÖ |
| Revoke Flow | [`revoke-flow.ts`](src/tui/flows/revoke-flow.ts) | ‚úÖ |
| Rotate Flow | [`rotate-flow.ts`](src/tui/flows/rotate-flow.ts) | ‚úÖ |
| Doctor Flow | [`doctor-flow.ts`](src/tui/flows/doctor-flow.ts) | ‚úÖ |

**TUI –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î:** `@inquirer/prompts`, `ora`

---

### Epic F: –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ—ñ—á—ñ
**–ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å: 60%**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º—ñ—Ç–∫–∞ |
|-----------|------|--------|----------|
| File Lock | [`lock.ts`](src/core/fs/lock.ts) | ‚úÖ | `FileLock`, `withLock` |
| Safe Temp Files | [`safe-tmp.ts`](src/core/fs/safe-tmp.ts) | ‚úÖ | `createSecureTempFile` |
| Git Adapter | [`git.ts`](src/core/git/git.ts) | ‚úÖ | –ü–æ–≤–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è |
| Diff | - | ‚ö†Ô∏è | –¢—ñ–ª—å–∫–∏ —Ç–∏–ø–∏, —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤ Epic C |
| JSON Schema | - | ‚ùå | –í—ñ–¥—Å—É—Ç–Ω—è |
| Auto-sync | - | ‚ùå | –í—ñ–¥—Å—É—Ç–Ω—è |

**Git Adapter –º–µ—Ç–æ–¥–∏:**
- ‚úÖ `isRepo()`, `status()`, `isDirty()`, `getBranch()`
- ‚úÖ `getFileAtHead()`, `diffFile()`
- ‚úÖ `add()`, `commit()`, `isTracked()`, `addToGitignore()`

---

## üß™ –ê–Ω–∞–ª—ñ–∑ —Ç–µ—Å—Ç—ñ–≤

### –ü–æ–∫—Ä–∏—Ç—Ç—è —Ç–µ—Å—Ç–∞–º–∏

| –ú–æ–¥—É–ª—å | –¢–µ—Å—Ç–∏ | –°—Ç–∞—Ç—É—Å |
|--------|-------|--------|
| config/load-config | ‚úÖ [`load-config.test.ts`](test/unit/config/load-config.test.ts) | 170 —Ä—è–¥–∫—ñ–≤, –ø–æ–≤–Ω–µ –ø–æ–∫—Ä–∏—Ç—Ç—è |
| config/load-policy | ‚úÖ [`load-policy.test.ts`](test/unit/config/load-policy.test.ts) | –ü—Ä–∏—Å—É—Ç–Ω—ñ–π |
| policy/canonical-json | ‚úÖ [`canonical-json.test.ts`](test/unit/policy/canonical-json.test.ts) | –ü—Ä–∏—Å—É—Ç–Ω—ñ–π |
| policy/signature | ‚úÖ [`signature.test.ts`](test/unit/policy/signature.test.ts) | –ü—Ä–∏—Å—É—Ç–Ω—ñ–π |
| sops/sops-adapter | ‚úÖ [`sops-adapter.test.ts`](test/unit/sops/sops-adapter.test.ts) | 208 —Ä—è–¥–∫—ñ–≤ |
| sops/sops-config-gen | ‚úÖ [`sops-config-gen.test.ts`](test/unit/sops/sops-config-gen.test.ts) | –ü—Ä–∏—Å—É—Ç–Ω—ñ–π |
| fs/lock | ‚úÖ [`lock.test.ts`](test/unit/fs/lock.test.ts) | –ü—Ä–∏—Å—É—Ç–Ω—ñ–π |
| fs/safe-tmp | ‚úÖ [`safe-tmp.test.ts`](test/unit/fs/safe-tmp.test.ts) | –ü—Ä–∏—Å—É—Ç–Ω—ñ–π |
| git/git | ‚úÖ [`git.test.ts`](test/unit/git/git.test.ts) | –ü—Ä–∏—Å—É—Ç–Ω—ñ–π |
| env/* | ‚ùå | **–í—ñ–¥—Å—É—Ç–Ω—ñ (–º–æ–¥—É–ª—å –Ω–µ —ñ—Å–Ω—É—î)** |
| integration/commands | ‚ö†Ô∏è | init, doctor |
| e2e/crypto | ‚ö†Ô∏è [`crypto.e2e.test.ts`](test/e2e/crypto.e2e.test.ts) | –ü–æ—Ç—Ä–µ–±—É—î RUN_E2E_TESTS=true |

**–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è vitest:** –ø–æ—Ä—ñ–≥ –ø–æ–∫—Ä–∏—Ç—Ç—è 95% –¥–ª—è core –º–æ–¥—É–ª—ñ–≤

---

## üìã –°–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤

### –ë–ª–æ–∫—É—é—á—ñ (–ø—Ä–æ–µ–∫—Ç –Ω–µ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è):
1. **`src/core/env/`** - –ø–æ–≤–Ω–∏–π –º–æ–¥—É–ª—å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π
   - `parse-dotenv.ts`
   - `render-dotenv.ts`
   - `diff-env.ts`
   - `index.ts`

### –í–∞–∂–ª–∏–≤—ñ (—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –æ–±–º–µ–∂–µ–Ω–∞):
2. JSON Schema –¥–ª—è config/policy (–≤–∞–ª—ñ–¥–∞—Ü—ñ—è)
3. Managed blocks –¥–ª—è .env (–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)

### –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ:
4. Auto-sync (watch mode)
5. Backup –ø–µ—Ä–µ–¥ –∑–º—ñ–Ω–∞–º–∏
6. Audit log

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ–≤ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 1 (–ö–†–ò–¢–ò–ß–ù–ò–ô) - –ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –≤—Å–µ —ñ–Ω—à–µ

```mermaid
graph TD
    A[–°—Ç–≤–æ—Ä–∏—Ç–∏ src/core/env/] --> B[parse-dotenv.ts]
    A --> C[render-dotenv.ts]
    A --> D[diff-env.ts]
    A --> E[index.ts]
    B --> F[–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó]
    C --> F
    D --> F
    E --> F
    F --> G[–†–æ–±–æ—á–∏–π pull command]
    F --> H[–†–æ–±–æ—á–∏–π edit command]
    F --> I[–†–æ–±–æ—á–∏–π TUI]
```

**–ü–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏:**

1. **`src/core/env/parse-dotenv.ts`**
   ```typescript
   interface ParseResult {
     env: EnvObject;
     order: string[];
     comments: Map<number, string>; // –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è managed blocks
   }
   
   export function parseDotenv(content: string): ParseResult;
   ```

2. **`src/core/env/render-dotenv.ts`**
   ```typescript
   interface RenderOptions {
     order?: string[];
     header?: string;
   }
   
   export function renderDotenv(data: EnvObject, options?: RenderOptions): string;
   ```

3. **`src/core/env/diff-env.ts`**
   ```typescript
   export function diffEnv(old: EnvObject, new: EnvObject): DiffResult;
   export function formatSafeDiff(diff: DiffResult): string;
   export function formatUnsafeDiff(diff: DiffResult, old: EnvObject, new: EnvObject): string;
   ```

4. **`src/core/env/index.ts`**
   ```typescript
   export * from './parse-dotenv.js';
   export * from './render-dotenv.js';
   export * from './diff-env.js';
   ```

5. **–¢–µ—Å—Ç–∏:** `test/unit/env/` –∑ –ø–æ–≤–Ω–∏–º –ø–æ–∫—Ä–∏—Ç—Ç—è–º

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 2 - –ü—ñ—Å–ª—è —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è

1. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö –∫–æ–º–∞–Ω–¥
2. E2E —Ç–µ—Å—Ç–∏ –∑ mock SOPS
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API

### –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 3 - –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è

1. Managed blocks (–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤)
2. JSON Schema –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
3. Auto-sync —Ä–µ–∂–∏–º
4. Audit logging

---

## üìä –î—ñ–∞–≥—Ä–∞–º–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```mermaid
graph TB
    subgraph Core
        types[types/index]
        config[config/*]
        sops[sops/*]
        policy[policy/*]
        fs[fs/*]
        git[git/*]
        env[env/*] -.- MISSING[‚ùå –í–Ü–î–°–£–¢–ù–Ü–ô]
    end
    
    subgraph CLI
        cli[cli/index]
        init[init]
        doctor[doctor]
        pull[pull] --> env
        edit --> env
        set --> env
        grant
        revoke
        rotate
        updatekeys
        ci-verify
    end
    
    subgraph TUI
        tui[tui/index]
        flows[flows/*] --> env
    end
    
    cli --> Core
    tui --> Core
```

---

## –í–∏—Å–Ω–æ–≤–æ–∫

–ü—Ä–æ–µ–∫—Ç –º–∞—î **–¥–æ–±—Ä—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É** —Ç–∞ **–∑–Ω–∞—á–Ω–∏–π –æ–±—Å—è–≥ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –∫–æ–¥—É**, –∞–ª–µ **–Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Å–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π** —á–µ—Ä–µ–∑ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ –º–æ–¥—É–ª—è `src/core/env/`.

**–û—Ü—ñ–Ω–∫–∞ –∑—É—Å–∏–ª—å –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ–¥—É–ª—è env: ~150-200 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É
- –¢–µ—Å—Ç–∏: ~200-250 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É
- –ß–∞—Å: –Ω–µ–≤–µ–ª–∏–∫–∏–π, –∞–ª–µ –∫—Ä–∏—Ç–∏—á–Ω–∏–π –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏

**–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫:** –ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏—Å—è –≤ Code mode —Ç–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–æ–¥—É–ª—å `src/core/env/`.
